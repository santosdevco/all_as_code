title: "üîç An√°lisis Inicial del Proyecto"
description: "Este prompt analiza el c√≥digo y genera un cuestionario YAML personalizado con solo las preguntas necesarias."

# ============================================
# PROMPT DE FASE 1: AN√ÅLISIS INICIAL
# ============================================
# Este prompt se ejecuta PRIMERO para:
# 1. Analizar el c√≥digo del proyecto
# 2. Identificar qu√© informaci√≥n se puede extraer autom√°ticamente
# 3. Generar un archivo YAML con:
#    - Preguntas solo sobre lo que NO se encontr√≥
#    - Template pre-llenado con la informaci√≥n encontrada
# ============================================

template: |
  # ROL
  Eres un Senior Software Architect y DevOps Expert que analiza proyectos para generar cuestionarios din√°micos.

  # CONTEXTO
  Vas a analizar el proyecto para identificar:
  - ‚úÖ Qu√© informaci√≥n PUEDES extraer del c√≥digo
  - ‚ùå Qu√© informaci√≥n NO puedes determinar con certeza
  
  Tu objetivo es generar un archivo YAML que contenga SOLO las preguntas necesarias.

  # TAREA

  ## PASO 1: Analizar el Proyecto Completo

  Examina minuciosamente:

  ### üê≥ Contenedorizaci√≥n
  - [ ] ¬øHay Dockerfile? ‚Üí Analiza: imagen base, puertos, ENV vars, comandos
  - [ ] ¬øHay docker-compose.yml? ‚Üí Analiza: servicios, vol√∫menes, networks, ports
  - [ ] ¬øSe usa Docker en m√∫ltiples ambientes? ‚Üí Busca: Dockerfile.dev, Dockerfile.prod
  
  ### ‚òÅÔ∏è Cloud Provider
  - [ ] ¬øHay archivos de AWS? ‚Üí Busca: cloudformation/, terraform/ con provider aws
  - [ ] ¬øHay archivos de IBM Cloud? ‚Üí Busca: ibmcloud.yml, manifest.yml, .bluemix/
  - [ ] ¬øHay archivos de GCP? ‚Üí Busca: app.yaml, cloudbuild.yaml, terraform/ con provider google
  - [ ] ¬øHay archivos de Azure? ‚Üí Busca: bicep/, terraform/ con provider azurerm
  
  ### ‚ò∏Ô∏è Orquestaci√≥n
  - [ ] ¬øKubernetes? ‚Üí Busca: k8s/, kubernetes/, manifests/, charts/, deployment.yaml
  - [ ] ¬øHelm Charts? ‚Üí Busca: charts/, Chart.yaml, values.yaml
  - [ ] ¬øKustomize? ‚Üí Busca: kustomization.yaml
  
  ### üîÑ CI/CD
  - [ ] GitHub Actions ‚Üí .github/workflows/*.yml
  - [ ] GitLab CI ‚Üí .gitlab-ci.yml
  - [ ] Jenkins ‚Üí Jenkinsfile
  - [ ] CircleCI ‚Üí .circleci/config.yml
  - [ ] Travis ‚Üí .travis.yml
  - [ ] Azure DevOps ‚Üí azure-pipelines.yml
  - [ ] IBM Toolchain ‚Üí .bluemix/toolchain.yml
  
  ### üìä Monitoreo
  - [ ] Prometheus ‚Üí Busca: prometheus.yml, ServiceMonitor
  - [ ] Grafana ‚Üí Busca: dashboards/, grafana/
  - [ ] Datadog ‚Üí Busca: datadog.yaml, DD_API_KEY
  - [ ] New Relic ‚Üí Busca: newrelic.yml, NEW_RELIC_LICENSE_KEY
  - [ ] CloudWatch ‚Üí Busca: referencias a AWS CloudWatch en c√≥digo
  - [ ] Sentry ‚Üí Busca: sentry.properties, SENTRY_DSN
  
  ### üóÑÔ∏è Base de Datos
  - [ ] Tipo de BD ‚Üí Analiza: package.json, requirements.txt, pom.xml
  - [ ] ORM/ODM ‚Üí Busca: prisma/, TypeORM, sequelize, mongoose, sqlalchemy
  - [ ] Migraciones ‚Üí Busca: migrations/, alembic/, flyway/
  - [ ] Conexi√≥n ‚Üí Analiza variables de entorno, config files
  
  ### üåç Ambientes
  - [ ] .env files ‚Üí .env.example, .env.development, .env.production
  - [ ] Config files ‚Üí config/development.js, config/production.js
  - [ ] Secrets ‚Üí busca referencias a secrets managers (AWS Secrets, IBM Key Protect)

  ## PASO 2: Clasificar la Informaci√≥n

  Para cada aspecto, clasifica como:

  ### ‚úÖ ENCONTRADO (certeza alta)
  - Hay evidencia clara en el c√≥digo
  - Puedes extraer valores concretos
  - **NO generar pregunta** - Incluir directamente en el template
  
  ### ‚ö†Ô∏è PARCIAL (certeza media)
  - Hay indicios pero faltan detalles
  - Generar pregunta con opciones limitadas
  - Pre-llenar con lo que encontraste
  
  ### ‚ùå NO ENCONTRADO (certeza baja)
  - No hay evidencia en el c√≥digo
  - Requiere conocimiento del equipo
  - **Generar pregunta completa**

  ## PASO 3: Generar el Archivo YAML

  Genera: `ai_prompts/07-generated.yaml`

  ### Estructura del YAML:

  ```yaml
  # ============================================
  # CUESTIONARIO GENERADO AUTOM√ÅTICAMENTE
  # Fecha: {{fecha_actual}}
  # Proyecto: {{nombre_proyecto}}
  # ============================================
  # 
  # Este archivo fue generado analizando el c√≥digo.
  # Solo contiene preguntas sobre informaci√≥n NO encontrada.
  # 
  # ‚úÖ ENCONTRADO - Ya incluido en el template
  # ‚ùå NO ENCONTRADO - Requiere respuesta manual
  # ============================================

  title: "Cuestionario de {{nombre_proyecto}}"
  description: "Completa la informaci√≥n faltante para generar documentaci√≥n completa."

  # Informaci√≥n ya extra√≠da del c√≥digo (NO requiere preguntas)
  auto_extracted:
    project_name: "{{nombre_del_proyecto}}"
    
    # Docker
    has_dockerfile: {{true/false}}
    dockerfile_base_image: "{{imagen_base o null}}"
    dockerfile_ports: [{{puertos o []}]
    has_compose: {{true/false}}
    compose_services: [{{servicios o []}]
    
    # Cloud Provider (detectado)
    cloud_providers_detected:
      - aws: {{true/false}}
      - ibm: {{true/false}}
      - gcp: {{true/false}}
      - azure: {{true/false}}
    
    # CI/CD (detectado)
    cicd_tool_detected: "{{github-actions/gitlab-ci/jenkins/null}}"
    cicd_file_found: "{{ruta del archivo o null}}"
    
    # Base de Datos
    database_type: "{{postgresql/mysql/mongodb/null}}"
    orm_detected: "{{prisma/typeorm/sequelize/null}}"
    
    # Monitoreo
    monitoring_tools_detected: [{{lista o []}]

  # SOLO preguntas sobre lo NO encontrado
  sections:
    # Solo incluir secciones con preguntas necesarias
    
    {{#if no_se_encontro_cloud_provider}}
    - icon: "‚òÅÔ∏è"
      title: "Cloud Provider"
      description: "No se detect√≥ cloud provider en el c√≥digo"
      questions:
        - id: cloudProvider
          type: checkbox
          label: "¬øQu√© cloud providers usa el proyecto?"
          options:
            - value: aws
              label: "AWS"
            - value: ibm
              label: "IBM Cloud"
            - value: gcp
              label: "GCP"
            - value: azure
              label: "Azure"
            - value: onpremise
              label: "On-Premise"
    {{/if}}
    
    {{#if no_se_encontro_deployment_platform}}
    - icon: "üöÄ"
      title: "Plataforma de Deployment"
      questions:
        - id: deployPlatform
          type: select
          label: "¬øD√≥nde se despliega en producci√≥n?"
          options:
            # Opciones basadas en cloud_providers_detected
            {{#if cloud_providers_detected.aws}}
            - value: eks
              label: "AWS EKS"
            - value: ecs
              label: "AWS ECS"
            - value: ec2
              label: "AWS EC2"
            {{/if}}
            {{#if cloud_providers_detected.ibm}}
            - value: ibm-kubernetes
              label: "IBM Kubernetes Service"
            - value: ibm-code-engine
              label: "IBM Code Engine"
            {{/if}}
            # ... etc
    {{/if}}
    
    # ... m√°s secciones solo si son necesarias

  # Template pre-llenado con informaci√≥n encontrada
  template: |
    # ROL
    Eres un DevOps Engineer documentando infraestructura.

    # CONTEXTO
    Proyecto: {{auto_extracted.project_name}}

    # INFORMACI√ìN EXTRA√çDA AUTOM√ÅTICAMENTE

    ## ‚úÖ Docker
    {{#if auto_extracted.has_dockerfile}}
    - Dockerfile encontrado: S√ç
    - Imagen base: {{auto_extracted.dockerfile_base_image}}
    - Puertos expuestos: {{auto_extracted.dockerfile_ports}}
    {{else}}
    - Dockerfile encontrado: NO
    {{/if}}

    {{#if auto_extracted.has_compose}}
    - Docker Compose: S√ç
    - Servicios: {{auto_extracted.compose_services}}
    {{else}}
    - Docker Compose: NO
    {{/if}}

    ## ‚úÖ Cloud Provider
    {{#if auto_extracted.cloud_providers_detected.aws}}
    - AWS: S√ç (archivos detectados)
    {{/if}}
    {{#if auto_extracted.cloud_providers_detected.ibm}}
    - IBM Cloud: S√ç (archivos detectados)
    {{/if}}
    {{#if auto_extracted.cloud_providers_detected.gcp}}
    - GCP: S√ç (archivos detectados)
    {{/if}}

    ## ‚úÖ CI/CD
    {{#if auto_extracted.cicd_tool_detected}}
    - Herramienta: {{auto_extracted.cicd_tool_detected}}
    - Archivo: {{auto_extracted.cicd_file_found}}
    [ANALIZAR EL ARCHIVO CI/CD Y DOCUMENTAR STAGES]
    {{else}}
    - CI/CD: NO DETECTADO
    [REQUIERE VALIDACI√ìN]
    {{/if}}

    ## ‚úÖ Base de Datos
    {{#if auto_extracted.database_type}}
    - Tipo: {{auto_extracted.database_type}}
    {{/if}}
    {{#if auto_extracted.orm_detected}}
    - ORM: {{auto_extracted.orm_detected}}
    {{/if}}

    ## ‚úÖ Monitoreo
    {{#if auto_extracted.monitoring_tools_detected}}
    Herramientas detectadas:
    {{#each auto_extracted.monitoring_tools_detected}}
    - {{this}}
    {{/each}}
    {{else}}
    - Monitoreo: NO DETECTADO
    [REQUIERE VALIDACI√ìN]
    {{/if}}

    # ‚ùå INFORMACI√ìN FALTANTE (del cuestionario)

    {{#cada respuesta del cuestionario}}
    - {{pregunta}}: {{respuesta}}
    {{/cada}}

    # TAREA

    Genera 3 archivos de documentaci√≥n:

    ## 1. ai_docs/06-infraestructura/01-deployment.md

    Usa TODA la informaci√≥n extra√≠da autom√°ticamente m√°s las respuestas del cuestionario.

    [Template completo con toda la info encontrada + respuestas]

    ## 2. ai_docs/06-infraestructura/02-ci-cd.md

    {{#if auto_extracted.cicd_file_found}}
    Analiza el archivo {{auto_extracted.cicd_file_found}} y documenta:
    - Stages del pipeline
    - Triggers
    - Variables de entorno
    - Secrets
    - Deployment autom√°tico/manual
    {{else}}
    Documenta que no hay CI/CD configurado.
    Recomienda implementar {{respuesta_herramienta_cicd_deseada}}.
    {{/if}}

    ## 3. ai_docs/06-infraestructura/03-monitoreo.md

    [Template con info de monitoreo encontrada + respuestas]

    # ARCHIVOS DE SALIDA

    1. ai_docs/06-infraestructura/01-deployment.md
    2. ai_docs/06-infraestructura/02-ci-cd.md
    3. ai_docs/06-infraestructura/03-monitoreo.md
  ```

  ## EJEMPLO DE OUTPUT

  Si encontraste:
  - ‚úÖ Dockerfile con Node.js
  - ‚úÖ GitHub Actions
  - ‚úÖ PostgreSQL en docker-compose
  - ‚ùå NO encontraste cloud provider
  - ‚ùå NO encontraste plataforma de deployment

  Entonces genera YAML con SOLO 2 preguntas:
  1. ¬øQu√© cloud provider?
  2. ¬øQu√© plataforma de deployment?

  Y el template ya incluye:
  - Info de Docker
  - Info de GitHub Actions
  - Info de PostgreSQL

  # REGLAS CR√çTICAS

  1. **Minimiza las preguntas** - Solo pregunta lo que NO puedes determinar
  2. **Analiza TODO el repositorio** - Revisa todos los archivos relevantes
  3. **Genera template rico** - Incluye toda la info que encontraste
  4. **Marca incertidumbres** - Si no est√°s 100% seguro, genera pregunta
  5. **Usa condicionales** - Preguntas anidadas basadas en respuestas anteriores

  # OUTPUT

  El archivo `ai_prompts/07-generated.yaml` con:
  - Lista de informaci√≥n auto-extra√≠da
  - Solo preguntas necesarias
  - Template pre-llenado con info encontrada
